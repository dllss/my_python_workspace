# TuShare 配置指南

## 简介

TuShare 是一个稳定、高质量的金融数据接口库，提供批量获取A股日线数据的功能。

**优势**：
- ✅ 一次性获取所有股票数据（5-10秒完成）
- ✅ 网络稳定（无需访问东方财富）
- ✅ 数据质量高
- ✅ 官方维护，长期稳定

**要求**：
- ⚠️ 需要注册账号（免费）
- ⚠️ 需要至少 120 积分（注册填写信息即可获得）

---

## 快速开始

### 1. 注册账号并获取 Token

1. **注册账号**：https://tushare.pro/register
2. **获取 Token**：https://tushare.pro/user/token
3. **获得积分**：在个人中心填写基本信息，即可获得 120 积分

### 2. 安装 TuShare

```bash
make install-tushare
```

或者手动安装：

```bash
poetry add tushare
```

### 3. 配置 Token

**方式1（推荐）：设置环境变量**

```bash
export TUSHARE_TOKEN="你的token"
```

**方式2：在 config.py 中配置**

编辑 `config.py`，找到 `TUSHARE_TOKEN` 配置项：

```python
TUSHARE_TOKEN = "你的token"
```

**方式3：命令行参数**

```bash
python fetch_daily_data_tushare.py --token "你的token"
```

### 4. 运行脚本

```bash
make daily-tushare
```

或者：

```bash
poetry run python fetch_daily_data_tushare.py
```

---

## 使用说明

### 基本用法

```bash
# 获取昨天的数据（默认）
make daily-tushare

# 获取指定日期的数据
poetry run python fetch_daily_data_tushare.py --date 20260210
```

### 运行时间建议

TuShare 的日线数据在每个交易日的 **15:00-17:00** 之间更新，建议在 **17:00 之后**运行脚本。

### 数据说明

- **更新频率**：每个交易日更新一次
- **数据范围**：所有A股（沪深两市）
- **数据字段**：开盘、最高、最低、收盘、成交量、成交额、涨跌幅、涨跌额
- **停牌处理**：自动过滤停牌数据

---

## 积分与权限

### 日线行情接口权限

| 积分等级 | 每分钟调用 | 每天调用 | 获取方式 |
|---------|-----------|---------|---------|
| **120** | 50次 | 8000次 | 注册并填写信息（免费） |
| 2000 | 200次 | 100000次 | 加入QQ会员群（200元）|
| 5000 | 500次 | 无限制 | 加入微信专业群 |

**说明**：
- 获取每日数据只需调用 **1次**（批量获取所有股票）
- 120 积分完全够用（每天 8000 次，远超需求）
- 积分不消耗，只要达到门槛即可调用

### 如何获得积分

1. **免费获得 120 积分**：
   - 注册账号
   - 在个人中心填写基本信息
   - 立即获得 120 积分

2. **获得更多积分**（可选）：
   - 参与社区贡献（提交问题、写文章）
   - 加入 QQ 会员群：200元 → 2000积分
   - 加入微信专业群：送 5000积分
   - 日常捐助：200元 → 2000积分

---

## 常见问题

### 1. 提示 Token 无效

**原因**：Token 配置错误或未配置

**解决**：
1. 检查 Token 是否正确复制（不要有多余空格）
2. 确认环境变量是否设置成功：`echo $TUSHARE_TOKEN`
3. 尝试在命令行直接指定：`--token "你的token"`

### 2. 提示积分不足

**原因**：账号积分低于 120

**解决**：
1. 登录 https://tushare.pro
2. 进入个人中心
3. 填写基本信息（姓名、手机号等）
4. 系统自动赠送 120 积分

### 3. 提示调用频率超限

**原因**：每分钟调用次数超过限制

**解决**：
- 120 积分：每分钟最多 50 次
- 获取每日数据只需 1 次调用，不会超限
- 如果需要更高频次，可以升级积分

### 4. 未获取到数据

**可能原因**：
1. 查询日期为非交易日（周末/节假日）
2. 数据尚未更新（建议在 17:00 后运行）
3. Token 权限不足

**解决**：
1. 检查是否为交易日：`make check-date DATE=20260210`
2. 等待数据更新后再运行
3. 检查 Token 和积分是否正常

### 5. 网络连接失败

**原因**：网络连接问题

**解决**：
1. 检查网络连接是否正常
2. 尝试使用代理（如果在国外）
3. 稍后重试

---

## 数据格式说明

### TuShare 原始格式

```
ts_code, trade_date, open, high, low, close, pre_close, 
change, pct_chg, vol, amount
```

### 项目标准格式（自动转换）

```
日期, 股票代码, 股票名称, 开盘, 最高, 最低, 收盘, 
成交量, 成交额, 涨跌幅, 涨跌额, 换手率
```

**单位转换**：
- 成交量：手（100股） → 股
- 成交额：千元 → 元

---

## 对比其他数据源

| 数据源 | 批量接口 | 速度 | 网络要求 | 费用 | 稳定性 |
|-------|---------|------|---------|------|--------|
| **TuShare** | ✅ | 5-10秒 | 无特殊要求 | 免费（需注册） | ⭐⭐⭐⭐⭐ |
| AkShare | ✅ | 5-10秒 | 需要访问东方财富 | 免费 | ⭐⭐⭐ |
| BaoStock | ❌ | 2小时 | 无特殊要求 | 免费 | ⭐⭐⭐⭐ |

**推荐**：
- 日常使用：`make daily-tushare`（TuShare，快速稳定）
- 备用方案：`make history`（BaoStock，慢但稳定）

---

## 进阶使用

### 获取指定日期的数据

```bash
# 获取 2026-02-10 的数据
poetry run python fetch_daily_data_tushare.py --date 20260210
```

### 批量补充历史数据

如果需要补充多天的历史数据，可以写一个简单的循环脚本：

```bash
#!/bin/bash
# 补充最近10天的数据
for i in {1..10}; do
    date=$(date -v-${i}d +%Y%m%d)  # macOS
    # date=$(date -d "-${i} days" +%Y%m%d)  # Linux
    echo "获取 $date 的数据..."
    poetry run python fetch_daily_data_tushare.py --date $date
    sleep 2  # 避免频率超限
done
```

### 定时任务

在 crontab 中添加定时任务，每天自动更新：

```bash
# 每天 17:30 自动更新
30 17 * * 1-5 cd /path/to/project && export TUSHARE_TOKEN="你的token" && make daily-tushare
```

---

## 技术支持

- **TuShare 官网**：https://tushare.pro
- **TuShare 文档**：https://tushare.pro/document/2
- **问题反馈**：https://tushare.pro/document/1?doc_id=40

---

## 更新日志

### v1.0 (2026-02-11)

- ✅ 创建 TuShare 版本的每日数据获取脚本
- ✅ 支持批量获取所有A股数据
- ✅ 自动转换为项目标准格式
- ✅ 自动补充股票名称
- ✅ 自动过滤停牌数据
- ✅ 自动更新元数据
- ✅ 支持多种 Token 配置方式
- ✅ 完善的错误提示和日志
